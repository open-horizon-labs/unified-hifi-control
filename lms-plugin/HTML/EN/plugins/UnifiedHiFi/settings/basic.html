[% PROCESS settings/header.html %]
    [% title = "PLUGIN_UNIFIED_HIFI" %]

    [% WRAPPER setting title="PLUGIN_UNIFIED_HIFI" desc="" %]
    <!-- Binary download status -->
    [% IF binaryStatus == 'not_downloaded' %]
    <div class="prefDesc" style="padding: 10px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; margin-bottom: 15px;">
        [% "PLUGIN_UNIFIED_HIFI_DOWNLOAD_NEEDED" | string(binaryPlatform) %]
    </div>
    [% ELSIF binaryStatus == 'downloading' %]
    <div class="prefDesc" style="padding: 10px; background: #cce5ff; border: 1px solid #007bff; border-radius: 4px; margin-bottom: 15px;">
        [% "PLUGIN_UNIFIED_HIFI_DOWNLOADING" | string(binaryPlatform) %]
        <script>setTimeout(function() { location.reload(); }, 5000);</script>
    </div>
    [% END %]

    <!-- Status indicator -->
    <div class="prefDesc">
        <b>[% "PLUGIN_UNIFIED_HIFI_STATUS" | string %]:</b>
        [% IF running %]
            <span style="color: #28a745; font-weight: bold;">
                &#9679; [% "PLUGIN_UNIFIED_HIFI_RUNNING" | string %]
            </span>
            &nbsp;&nbsp;
            <input type="submit" value="[% "PLUGIN_UNIFIED_HIFI_OPENUI" | string %] &#8594;" onclick="window.open('[% webUrl %]', '_blank'); return false;" />
        [% ELSE %]
            <span style="color: #dc3545; font-weight: bold;">
                &#9679; [% "PLUGIN_UNIFIED_HIFI_STOPPED" | string %]
            </span>
        [% END %]
    </div>

    <!-- Manual start/stop -->
        [% IF running %]
            <input type="submit" name="stop" value="[% "PLUGIN_UNIFIED_HIFI_STOP_BRIDGE" | string %]" />
        [% ELSE %]
            <input type="submit" name="start" value="[% "PLUGIN_UNIFIED_HIFI_START_BRIDGE" | string %]" />
        [% END %]
    [% END %]

    [% WRAPPER setting title="PLUGIN_UNIFIED_HIFI_AUTORUN" desc="PLUGIN_UNIFIED_HIFI_AUTORUN_DESC" %]
        <input type="checkbox" name="pref_autorun" id="pref_autorun"
               value="1" [% IF prefs.autorun %]checked[% END %] />
        <label for="pref_autorun">Enable auto-start</label>
    [% END %]

    [% WRAPPER setting title="PLUGIN_UNIFIED_HIFI_PORT" desc="PLUGIN_UNIFIED_HIFI_PORT_DESC" %]
        <input type="number" name="pref_port" id="pref_port"
               value="[% prefs.port || 8088 %]" min="1024" max="65535"
               style="width: 80px;" />
    [% END %]

    [% IF binaries.size > 1; WRAPPER setting title="PLUGIN_UNIFIED_HIFI_BINARY" desc="PLUGIN_UNIFIED_HIFI_BINARY_DESC" %]
        <select name="pref_bin" id="pref_bin">
            [% FOREACH bin IN binaries %]
                <option value="[% bin %]"
                        [% IF prefs.bin == bin %]selected[% END %]>
                    [% bin %]
                </option>
            [% END %]
        </select>
    [% END; END %]

<!-- Knob Configuration Section -->
    <hr/>
    [% WRAPPER setting title="PLUGIN_UNIFIED_HIFI_KNOB" desc="" %]
        <style>
            .knob-list th {
                text-align: left;
                padding-right: 15px;
                font-weight: bold;
            }
        </style>
        <table>
            <tr class="knob-list">
                <th>[% "PLUGIN_UNIFIED_HIFI_KNOB_NAME" | string %]</th>
                <th>[% "PLUGIN_UNIFIED_HIFI_KNOB_ID"| string %]</th>
                <th>[% "PLUGIN_UNIFIED_HIFI_KNOB_FIRMWARE"| string %]</th>
                <th>[% "PLUGIN_UNIFIED_HIFI_KNOB_BATTERY"| string %]</th>
                <th></th>
            </tr>
            [% FOREACH knob = knobStatus.knobs %]
                <tr>
                    <td style="vertical-align: middle; padding-right: 10px">[% knob.name | html %]</td>
                    <td style="vertical-align: middle; padding-right: 10px">[% knob.knob_id | html %]</td>
                    <td style="vertical-align: middle; padding-right: 10px">[% knob.version | html %]</td>
                    <td style="vertical-align: middle; padding-right: 10px">
                        [% IF knob.status.battery_level %]
                            [% knob.status.battery_level %]%
                            [% IF knob.status.battery_charging; "PLUGIN_UNIFIED_HIFI_KNOB_BATTERY_CHARGING" FILTER string; END %]
                        [% ELSE %]
                            N/A
                        [% END %]
                    </td>
                    <td>
                        <input type="submit" value="[% "EDIT" | string %] &#8594;" onclick="window.open('[% webUrl %]/knobs', '_blank'); return false;" />
                    </td>
                </tr>
            [% END %]
        </table>
    [% END %]
[% PROCESS settings/footer.html %]
