[% PROCESS settings/header.html %]

<div class="settingGroup">
    <div class="prefHead" style="font-size: 1.2em; margin-bottom: 10px;">
        [% "PLUGIN_UNIFIED_HIFI" | string %]
    </div>

    <!-- Status indicator -->
    <div class="prefDesc" style="padding: 10px; background: #f5f5f5; border-radius: 4px; margin-bottom: 15px;">
        <b>[% "PLUGIN_UNIFIED_HIFI_STATUS" | string %]:</b>
        [% IF running %]
            <span style="color: #28a745; font-weight: bold;">
                &#9679; [% "PLUGIN_UNIFIED_HIFI_RUNNING" | string %]
            </span>
            &nbsp;&nbsp;
            <a href="[% webUrl %]" target="_blank"
               style="display: inline-block; padding: 4px 12px; background: #007bff; color: white; text-decoration: none; border-radius: 3px;">
                [% "PLUGIN_UNIFIED_HIFI_OPENUI" | string %] &#8594;
            </a>
        [% ELSE %]
            <span style="color: #dc3545; font-weight: bold;">
                &#9679; [% "PLUGIN_UNIFIED_HIFI_STOPPED" | string %]
            </span>
        [% END %]
    </div>

    <!-- Manual start/stop -->
    <div class="prefDesc" style="margin-bottom: 20px;">
        [% IF running %]
            <input type="submit" name="stop" value="Stop Bridge"
                   style="padding: 6px 16px; cursor: pointer;" />
        [% ELSE %]
            <input type="submit" name="start" value="Start Bridge"
                   style="padding: 6px 16px; cursor: pointer;" />
        [% END %]
    </div>
</div>

<div class="settingGroup">
    <div class="prefHead">
        [% "PLUGIN_UNIFIED_HIFI_AUTORUN" | string %]
    </div>
    <div class="prefDesc">
        [% "PLUGIN_UNIFIED_HIFI_AUTORUN_DESC" | string %]
    </div>
    <div class="prefValue">
        <input type="checkbox" name="pref_autorun" id="pref_autorun"
               value="1" [% IF prefs.autorun %]checked[% END %] />
        <label for="pref_autorun">Enable auto-start</label>
    </div>
</div>

<div class="settingGroup">
    <div class="prefHead">
        [% "PLUGIN_UNIFIED_HIFI_PORT" | string %]
    </div>
    <div class="prefDesc">
        [% "PLUGIN_UNIFIED_HIFI_PORT_DESC" | string %]
    </div>
    <div class="prefValue">
        <input type="number" name="pref_port" id="pref_port"
               value="[% prefs.port || 8088 %]" min="1024" max="65535"
               style="width: 80px;" />
    </div>
</div>

[% IF binaries.size > 1 %]
<div class="settingGroup">
    <div class="prefHead">
        [% "PLUGIN_UNIFIED_HIFI_BINARY" | string %]
    </div>
    <div class="prefDesc">
        [% "PLUGIN_UNIFIED_HIFI_BINARY_DESC" | string %]
    </div>
    <div class="prefValue">
        <select name="pref_bin" id="pref_bin">
            [% FOREACH bin IN binaries %]
                <option value="[% bin %]"
                        [% IF prefs.bin == bin %]selected[% END %]>
                    [% bin %]
                </option>
            [% END %]
        </select>
    </div>
</div>
[% END %]

<div class="settingGroup">
    <div class="prefHead">
        [% "PLUGIN_UNIFIED_HIFI_LOGLEVEL" | string %]
    </div>
    <div class="prefDesc">
        [% "PLUGIN_UNIFIED_HIFI_LOGLEVEL_DESC" | string %]
    </div>
    <div class="prefValue">
        <select name="pref_loglevel" id="pref_loglevel">
            [% FOREACH level IN loglevels %]
                <option value="[% level %]"
                        [% IF prefs.loglevel == level %]selected[% END %]>
                    [% level %]
                </option>
            [% END %]
        </select>
    </div>
</div>

<!-- Knob Configuration Section -->
<div class="settingGroup" style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 15px;">
    <div class="prefHead" style="font-size: 1.1em; margin-bottom: 10px;">
        [% "PLUGIN_UNIFIED_HIFI_KNOB" | string %]
    </div>

    [% IF knobStatus.last_seen %]
    <div class="prefDesc" style="padding: 8px; background: #e8f5e9; border-radius: 4px; margin-bottom: 10px;">
        <b>Status:</b> Connected
        &nbsp;|&nbsp; <b>ID:</b> [% knobStatus.knob_id %]
        [% IF knobStatus.version %]&nbsp;|&nbsp; <b>Firmware:</b> [% knobStatus.version %][% END %]
        [% IF knobStatus.status.battery_level %]
            &nbsp;|&nbsp; <b>Battery:</b> [% knobStatus.status.battery_level %]%
            [% IF knobStatus.status.battery_charging %](charging)[% END %]
        [% END %]
    </div>
    [% END %]

    <div class="prefDesc">
        [% "PLUGIN_UNIFIED_HIFI_KNOB_DESC" | string %]
    </div>
</div>

<div class="settingGroup">
    <div class="prefHead">
        [% "PLUGIN_UNIFIED_HIFI_KNOB_NAME" | string %]
    </div>
    <div class="prefDesc">
        [% "PLUGIN_UNIFIED_HIFI_KNOB_NAME_DESC" | string %]
    </div>
    <div class="prefValue">
        <input type="text" name="pref_knob_name" id="pref_knob_name"
               value="[% prefs.knob_name %]" style="width: 200px;"
               placeholder="My Knob" />
    </div>
</div>

<div class="settingGroup">
    <div class="prefHead">
        [% "PLUGIN_UNIFIED_HIFI_KNOB_ROTATION" | string %]
    </div>
    <div class="prefDesc">
        [% "PLUGIN_UNIFIED_HIFI_KNOB_ROTATION_DESC" | string %]
    </div>
    [% SET rot_charging = prefs.knob_rotation_charging.defined ? prefs.knob_rotation_charging : 180 %]
    [% SET rot_battery = prefs.knob_rotation_battery.defined ? prefs.knob_rotation_battery : 0 %]
    <div class="prefValue">
        <label style="display: inline-block; width: 120px;">When charging:</label>
        <select name="pref_knob_rotation_charging" id="pref_knob_rotation_charging">
            [% FOREACH rot IN rotations %]
                <option value="[% rot %]"
                        [% IF rot_charging == rot %]selected[% END %]>
                    [% rot %]&deg;
                </option>
            [% END %]
        </select>
        <br/><br/>
        <label style="display: inline-block; width: 120px;">On battery:</label>
        <select name="pref_knob_rotation_battery" id="pref_knob_rotation_battery">
            [% FOREACH rot IN rotations %]
                <option value="[% rot %]"
                        [% IF rot_battery == rot %]selected[% END %]>
                    [% rot %]&deg;
                </option>
            [% END %]
        </select>
    </div>
</div>

<div class="settingGroup">
    <div class="prefHead">
        [% "PLUGIN_UNIFIED_HIFI_KNOB_POWER_CHARGING" | string %]
    </div>
    <div class="prefDesc">
        [% "PLUGIN_UNIFIED_HIFI_KNOB_POWER_CHARGING_DESC" | string %]
    </div>
    <div class="prefValue">
        <label style="display: inline-block; width: 120px;">Art mode after:</label>
        <input type="number" name="pref_knob_art_mode_charging" id="pref_knob_art_mode_charging"
               value="[% prefs.knob_art_mode_charging || 60 %]" min="0" max="3600"
               style="width: 60px;" /> sec (0 = disabled)
        <br/><br/>
        <label style="display: inline-block; width: 120px;">Dim after:</label>
        <input type="number" name="pref_knob_dim_charging" id="pref_knob_dim_charging"
               value="[% prefs.knob_dim_charging || 120 %]" min="0" max="3600"
               style="width: 60px;" /> sec (0 = disabled)
        <br/><br/>
        <label style="display: inline-block; width: 120px;">Sleep after:</label>
        <input type="number" name="pref_knob_sleep_charging" id="pref_knob_sleep_charging"
               value="[% prefs.knob_sleep_charging || 0 %]" min="0" max="3600"
               style="width: 60px;" /> sec (0 = disabled)
    </div>
</div>

<div class="settingGroup">
    <div class="prefHead">
        [% "PLUGIN_UNIFIED_HIFI_KNOB_POWER_BATTERY" | string %]
    </div>
    <div class="prefDesc">
        [% "PLUGIN_UNIFIED_HIFI_KNOB_POWER_BATTERY_DESC" | string %]
    </div>
    <div class="prefValue">
        <label style="display: inline-block; width: 120px;">Art mode after:</label>
        <input type="number" name="pref_knob_art_mode_battery" id="pref_knob_art_mode_battery"
               value="[% prefs.knob_art_mode_battery || 30 %]" min="0" max="3600"
               style="width: 60px;" /> sec (0 = disabled)
        <br/><br/>
        <label style="display: inline-block; width: 120px;">Dim after:</label>
        <input type="number" name="pref_knob_dim_battery" id="pref_knob_dim_battery"
               value="[% prefs.knob_dim_battery || 30 %]" min="0" max="3600"
               style="width: 60px;" /> sec (0 = disabled)
        <br/><br/>
        <label style="display: inline-block; width: 120px;">Sleep after:</label>
        <input type="number" name="pref_knob_sleep_battery" id="pref_knob_sleep_battery"
               value="[% prefs.knob_sleep_battery || 60 %]" min="0" max="3600"
               style="width: 60px;" /> sec (0 = disabled)
    </div>
</div>

[% PROCESS settings/footer.html %]
